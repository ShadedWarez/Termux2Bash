#!/data/data/com.termux/files/usr/bin/bash

# Install required packages
apt install proot proot-distro bsdtar axel neofetch -y
clear

# Display the menu
echo "Select your Distro:"
echo "1. alma"
echo "2. alpine"
echo "3. altlinux"
echo "4. amazon"
echo "5. archlinux"
echo "6. artix"
echo "7. backbox"
echo "8. blackarch"
echo "9. centos"
echo "10. chimera"
echo "11. debian"
echo "12. debkali"
echo "13. deepin"
echo "14. devuan"
echo "15. fedora"
echo "16. gentoo"
echo "17. kali"
echo "18. manjaro"
echo "19. openeuler"
echo "20. openkylin"
echo "21. openwrt"
echo "22. opensuse"
echo "23. oracle"
echo "24. pardus"
echo "25. parrot"
echo "26. photon"
echo "27. rocky"
echo "28. ubuntu"
echo "29. ujammy"
echo "30. void"

# Read the user's choice
read -p "Enter the number: " choice

# Set the FS variable based on the user's choice
case $choice in
    1)
        FS="alma"
        ;;
    2)
        FS="alpine"
        ;;
    3)
        FS="altlinux"
        ;;
    4)
        FS="amazon"
        ;;
    5)
        FS="archlinux"
        ;;
    6)
        FS="artix"
        ;;
    7)
        FS="backbox"
        ;;
    8)
        FS="blackarch"
        ;;
    9)
        FS="centos"
        ;;
    10)
        FS="chimera"
        ;;
    11)
        FS="debian"
        ;;
    12)
        FS="debkali"
        ;;
    13)
        FS="deepin"
        ;;
    14)
        FS="devuan"
        ;;
    15)
        FS="fedora"
        ;;
    16)
        FS="gentoo"
        ;;
    17)
        FS="kali"
        ;;
    18)
        FS="manjaro"
        ;;
    19)
        FS="openeuler"
        ;;
    20)
        FS="openkylin"
        ;;
    21)
        FS="openwrt"
        ;;
    22)
        FS="opensuse"
        ;;
    23)
        FS="oracle"
        ;;
    24)
        FS="pardus"
        ;;
    25)
        FS="parrot"
        ;;
    26)
        FS="photon"
        ;;
    27)
        FS="rocky"
        ;;
    28)
        FS="ubuntu"
        ;;
    29)
        FS="ujammy"
        ;;
    30)
        FS="void"
        ;;
    *)
        echo "Invalid selection. Exiting."
        exit 1
        ;;
esac

clear

# Read FS value
FS="$FS"

# Forward the value of FS to NM
NM="$FS"

# Capitalize the first letter of NM
NM=$(echo "$NM" | awk '{print toupper(substr($0,1,1)) substr($0,2)}')

# Display neofetch with custom ASCII art
neofetch --ascii_distro "${NM}"

# Output the selected value
echo "You selected $NM Linux"
echo " "

# Create necessary directories
mkdir -p "$PREFIX/var/lib/proot-distro/installed-rootfs"

# Change directory
cd "$PREFIX/var/lib/proot-distro/installed-rootfs/"

# Download the rootfs using axel
axel -a -o "${FS}.tar.xz" "https://github.com/xiv3r/Termux-Pentesting-Distro/releases/download/rootfs/${FS}.tar.xz"

# Extract the rootfs
echo "[*] Extracting ${NM} Linux Rootfs, Please wait...!!!"
proot --link2symlink bsdtar -xpJf "${FS}.tar.xz" 2>/dev/null

# Create a proot-distro configuration file for the Kali minimal rootfs
cat > "$PREFIX/etc/proot-distro/${FS}.sh" << EOF
DISTRO_NAME="${NM} Linux"
TARBALL_URL['aarch64']="https://github.com/xiv3r/Termux-Pentesting-Distro/releases/download/rootfs/${FS}.tar.xz"
TARBALL_SHA256['aarch64']="$(sha256sum "${FS}.tar.xz" | awk '{print $1}')"
EOF

# Create a shortcut command to launch the distro
cat > "$PREFIX/bin/${FS}" << EOF
#!/data/data/com.termux/files/usr/bin/bash

proot-distro login ${FS}
EOF

# Fix shebang and set executable permissions
termux-fix-shebang "$PREFIX/bin/${FS}"
chmod 700 "$PREFIX/bin/${FS}"

# Add start-up login notification
cat >> $PREFIX/etc/bash.bashrc << EOF
echo "Login ${NM} Linux: ${FS}"
EOF

# Add support for uninstallation
cat > $PREFIX/bin/uninstall-${FS} << EOF
#!/data/data/com.termux/files/usr/bin/bash

proot-distro remove ${FS}
sed -i 's/echo "Login ${NM} Linux: ${FS}"//g' $PREFIX/etc/bash.bashrc
rm -rf $PREFIX/bin/uninstall-${FS}
rm -rf $PREFIX/bin/${FS}
rm -rf $PREFIX/var/lib/proot-distro/dlcache/${FS}.tar.xz
EOF
chmod 700 "$PREFIX/bin/uninstall-${FS}"

# Backup tarball to the cache
mkdir -p "$PREFIX/var/lib/proot-distro/dlcache"
mv "${FS}.tar.xz" "$PREFIX/var/lib/proot-distro/dlcache"

# Display final instructions
echo -e '\e[1;93m'
cat << EOF
Successful Installation!

To login ${NM} Linux, Type: ${FS}
EOF
