#!/data/data/com.termux/files/usr/bin/bash

cd $HOME
###
neofetch --ascii_distro Kali -L
###
axel -a --search -o kali-full.tar.xz https://kali.download/nethunter-images/current/rootfs/kali-nethunter-rootfs-full-arm64.tar.xz
###
cat <<EOF
[*] Extracting rootfs...!!!
[*] 15 minutes to extract please wait...!!!
EOF
###
proot --link2symlink bsdtar -xpJf kali-full.tar.xz 2>/dev/null
###
cat >>$PREFIX/etc/bash.bashrc << EOF
clear
neofetch --ascii_distro Kali -L
(kali vnc) &
kali
EOF
###
wget -O kali-arm64/bin/vnc https://raw.githubusercontent.com/xiv3r/Termux-Pentesting-Distro/refs/heads/main/KaliLinux/Chroot/vnc
###
chmod 700 kali-arm64/bin/vnc
###
wget -O $PREFIX/bin/kali https://raw.githubusercontent.com/xiv3r/Termux-Pentesting-Distro/refs/heads/main/KaliLinux/Chroot/nethunter
###
chmod 700 $PREFIX/bin/kali
###
sed -i '/if/,/fi/d' kali-arm64/root/.bash_profile
###
echo "export PULSE_SERVER=127.0.0.1" >> kali-arm64/home/kali/.vnc/xstartup
###
cat >kali-arm64/etc/resolv.conf << EOF
nameserver 9.9.9.9
nameserver 8.8.8.8
EOF
###
wget -O kali-arm64/root/.bashrc https://raw.githubusercontent.com/xiv3r/Termux-Pentesting-Distro/refs/heads/main/KaliLinux/rcfiles/rootbash.bashrc
###
wget -O kali-arm64/root/.zshrc https://raw.githubusercontent.com/xiv3r/Termux-Pentesting-Distro/refs/heads/main/KaliLinux/rcfiles/root.zshrc
###
wget -O kali-arm64/home/kali/.bashrc https://raw.githubusercontent.com/xiv3r/Termux-Pentesting-Distro/refs/heads/main/KaliLinux/rcfiles/homebash.bashrc
###
wget -O kali-arm64/home/kali.zshrc https://raw.githubusercontent.com/xiv3r/Termux-Pentesting-Distro/refs/heads/main/KaliLinux/rcfiles/home.zshrc
###
wget -O kali-arm64/etc/bash.bashrc https://raw.githubusercontent.com/xiv3r/Termux-Pentesting-Distro/refs/heads/main/KaliLinux/rcfiles/etcbash.bashrc
###
chmod +s kali-arm64/usr/bin/sudo
###
chmod +s kali-arm64/usr/bin/su
###
echo "kali    ALL=(ALL:ALL) ALL" >kali-arm64/etc/sudoers.d/kali
###
echo "Set disable_coredump false" >kali-arm64/etc/sudo.conf
###
cat <<EOF
[*] To configure VNC
type: kali vnc passwd
type: kali vnc &
EOF
###
USRID=$(id -u)
GRPID=$(id -g)
kali -r usermod -u "$USRID" kali 2>/dev/null
kali -r groupmod -g "$GRPID" kali 2>/dev/null
